<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FS • Счётчик и водоочистка</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="home">

  <!-- Topbar -->
  <header class="topbar">
    <a class="brand" href="#hero">FS<span class="thin">воду</span></a>
    <nav class="nav">
      <a href="#why">Почему это важно</a>
      <a href="#what">Что делает FS</a>
      <a href="#how">Как очищаем</a>
      <a href="services.html">Услуги</a>
    </nav>
  </header>

  <!-- HERO / COUNTER -->
  <section id="hero" class="hero">
    <div class="wrap">
      <div class="capsule" aria-live="polite">
        <div id="odo" class="odo" data-digits="6"></div>
      </div>
      <p class="hero-sub impact">
        Именно столько тысяч пластиковых бутылок выбрасывается в России, пока вы здесь
      </p>
    </div>
  </section>

  <!-- WHY -->
  <section id="why" class="why">
    <div class="why-bg">
      <canvas id="bottlesCanvas" aria-hidden="true"></canvas>
    </div>
    <div class="why-inner reveal">
      <h2 class="impact">Почему это важно</h2>
      <p>
        Каждую секунду — тысячи пластиковых бутылок, которые никогда не исчезнут.
        FS создаёт системы, которые очищают воду и уменьшают количество отходов,
        возвращая природе то, что ей принадлежит.
      </p>
    </div>
  </section>

  <!-- WHAT (cards -> services anchors) -->
  <section id="what" class="what">
    <div class="wrap">
      <h2 class="impact reveal">Что делает FS</h2>

      <div class="cards scroller snap-x">
        <a class="card reveal" href="services.html#house">
          <div class="card-body">
            <h3 class="impact">Частные дома</h3>
            <p>Комплексы водоочистки для коттеджей и загородных домов.</p>
          </div>
        </a>

        <a class="card reveal" href="services.html#dev">
          <div class="card-body">
            <h3 class="impact">Девелоперы</h3>
            <p>Станции для МКД и кварталов с резервированием и телеметрией.</p>
          </div>
        </a>

        <a class="card reveal" href="services.html#apt">
          <div class="card-body">
            <h3 class="impact">Квартиры</h3>
            <p>Компактные системы с мембраной и минерализацией.</p>
          </div>
        </a>

        <a class="card reveal" href="services.html#service">
          <div class="card-body">
            <h3 class="impact">Сервис</h3>
            <p>Регламентное обслуживание, аварийные выезды и SLA.</p>
          </div>
        </a>
      </div>
    </div>
  </section>

  <!-- HOW (pipe) -->
  <section id="how" class="how">
    <div class="wrap">
      <h2 class="impact reveal">Как мы очищаем воду</h2>

      <div class="pipe-wrap reveal">
        <!-- SVG-поток слева направо -->
        <svg class="pipe" viewBox="0 0 1200 220" preserveAspectRatio="xMidYMid meet" role="img" aria-label="Схема потока воды">
          <!-- труба -->
          <rect x="40" y="80" width="1120" height="60" rx="30" class="pipe-body"/>
          <!-- вода -->
          <defs>
            <linearGradient id="waterGrad" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%"  stop-color="#bfe0ff"/>
              <stop offset="100%" stop-color="#2b8cff"/>
            </linearGradient>
            <pattern id="waterPattern" width="300" height="60" patternUnits="userSpaceOnUse">
              <rect width="300" height="60" fill="url(#waterGrad)"/>
              <g opacity=".35">
                <circle cx="40" cy="20" r="4" fill="#fff"/>
                <circle cx="120" cy="38" r="3" fill="#fff"/>
                <circle cx="220" cy="28" r="3" fill="#fff"/>
              </g>
            </pattern>
            <clipPath id="pipeClip">
              <rect x="40" y="80" width="1120" height="60" rx="30"/>
            </clipPath>
          </defs>
          <g clip-path="url(#pipeClip)">
            <rect id="waterFlow" x="40" y="80" width="1600" height="60" fill="url(#waterPattern)"/>
          </g>
          <!-- точки -->
          <g class="dots">
            <circle class="dot" data-step="0" cx="140"  cy="110" r="10"/>
            <circle class="dot" data-step="1" cx="420"  cy="110" r="10"/>
            <circle class="dot" data-step="2" cx="680"  cy="110" r="10"/>
            <circle class="dot" data-step="3" cx="900"  cy="110" r="10"/>
            <circle class="dot" data-step="4" cx="1080" cy="110" r="10"/>
          </g>
        </svg>

        <div class="steps">
          <div class="step on" data-step="0">
            <h3 class="impact">Грубая очистка</h3>
            <p>Удаляем песок, ржавчину, механические примеси. Защищаем сантехнику и узлы.</p>
          </div>
          <div class="step" data-step="1">
            <h3 class="impact">Сорбция</h3>
            <p>Активированный уголь поглощает запахи и органику, улучшая вкус воды.</p>
          </div>
          <div class="step" data-step="2">
            <h3 class="impact">Мембрана</h3>
            <p>Тонкая очистка: задерживаем соли, тяжёлые металлы и микроорганизмы.</p>
          </div>
          <div class="step" data-step="3">
            <h3 class="impact">Минерализация</h3>
            <p>Возвращаем полезные минералы для баланса и приятного вкуса.</p>
          </div>
          <div class="step" data-step="4">
            <h3 class="impact">УФ-обеззараживание</h3>
            <p>Финальный барьер: безопасная дезинфекция без химии.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="wrap">
      <span>© FS Engineering</span>
      <nav>
        <a href="#hero">Главная</a>
        <a href="services.html">Услуги</a>
      </nav>
    </div>
  </footer>

  <!-- JS -->
  <script>
  /* ---------- HELPERS: reveal + мягкий параллакс ---------- */
  (function(){
    const rev = document.querySelectorAll('.reveal');
    if('IntersectionObserver' in window){
      const io=new IntersectionObserver(es=>es.forEach(e=>{if(e.isIntersecting)e.target.classList.add('on')}),{threshold:.15});
      rev.forEach(x=>io.observe(x));
    }else rev.forEach(x=>x.classList.add('on'));

    // очень нежный параллакс (±8px)
    const plx = document.querySelectorAll('[data-parallax]');
    let ticking=false;
    const onScroll=()=>{ if(ticking) return; ticking=true; requestAnimationFrame(()=>{
      const st=window.scrollY, h=window.innerHeight;
      plx.forEach(el=>{
        const r=el.getBoundingClientRect(); if(r.top>h||r.bottom<0)return;
        const t=(r.top-h/2)/h; el.style.transform=`translateY(${t*8}px)`;
      });
      ticking=false;
    }); };
    window.addEventListener('scroll',onScroll,{passive:true}); onScroll();
  })();

  /* ---------- ODOMETER: сверху-вниз, плавнее, адаптив ---------- */
  (function(){
    const container = document.getElementById('odo'); if(!container) return;
    const DIGITS = parseInt(container.dataset.digits||'6',10);
    const RATE   = 6000; // бутылок/секунда (реальные данные), считаем тысячами
    const STEP_MS= 70;   // частота анимации
    // построение столбцов
    const makeDigit=()=>{
      const d=document.createElement('div'); d.className='digit';
      const s=document.createElement('div'); s.className='strip';
      for(let i=0;i<10;i++){ const c=document.createElement('div'); c.className='cell'; c.textContent=i; s.appendChild(c); }
      // дублируем 0 внизу для мягкой прокрутки вниз
      const again=document.createElement('div'); again.className='cell'; again.textContent='0'; s.appendChild(again);
      d.appendChild(s); return d;
    };
    container.innerHTML='';
    for(let i=0;i<DIGITS;i++) container.appendChild(makeDigit());
    const strips=[...container.querySelectorAll('.strip')];
    const cellH = ()=>container.querySelector('.cell').getBoundingClientRect().height;

    // responsive font size: вычисляем на лету
    const resize=()=>{
      const vw=Math.min(window.innerWidth,1024);
      container.style.setProperty('--digit-size', Math.max(44, vw*0.11)+'px');
      container.style.setProperty('--digit-width',Math.max(36, vw*0.08)+'px');
      // обновить позицию, чтобы не торчали верхние цифры
      apply(cur);
    };
    window.addEventListener('resize',()=>{resize();});
    // счётчик
    let start=performance.now(), cur=0, lastTick=0;
    const value=()=>Math.floor(((performance.now()-start)/1000)*RATE/1000); // отображаем в тысячах
    function apply(n){
      const s = String(n).padStart(DIGITS,'0').slice(-DIGITS);
      const h = cellH();
      for(let i=0;i<DIGITS;i++){
        const v = parseInt(s[i],10);
        const y = v*h; // движемся ВНИЗ
        strips[i].style.transform=`translate3d(0,${y*-1}px,0)`;
      }
    }
    function tick(now){
      if(now-lastTick>STEP_MS){ cur=value(); apply(cur); lastTick=now; }
      requestAnimationFrame(tick);
    }
    resize(); tick(performance.now());
  })();

  /* ---------- БУТЫЛКИ за блоком WHY (всегда падают) ---------- */
  (function bottlesField(){
    const cvs=document.getElementById('bottlesCanvas'); if(!cvs) return;
    const ctx=cvs.getContext('2d');
    let DPR=window.devicePixelRatio||1, running=false, parts=[], raf=0;

    function resize(){
      const r=cvs.getBoundingClientRect();
      cvs.width = Math.floor(r.width*DPR);
      cvs.height= Math.floor(r.height*DPR);
      seed();
    }
    function sprite(size=64){
      const o=document.createElement('canvas'); o.width=o.height=size;
      const c=o.getContext('2d'); c.globalAlpha=.10; c.fillStyle='#2b8cff';
      c.save(); c.translate(size/2,size/2); c.rotate(-Math.PI/2.2);
      const w=size*.55,h=size*.22,r=h/2,x=-w/2,y=-h/2;
      c.beginPath();
      c.moveTo(x+r,y);
      c.arcTo(x+w,y,x+w,y+h,r); c.arcTo(x+w,y+h,x,y+h,r);
      c.arcTo(x,y+h,x,y,r);     c.arcTo(x,y,x+w,y,r);
      c.closePath(); c.fill();
      c.fillRect(w/2.1,-h*.15,size*.12,h*1.3);
      c.restore(); return o;
    }
    const spr=sprite(64);
    function seed(){
      const w=cvs.clientWidth, h=cvs.clientHeight;
      const count=Math.round((w*h)/16000)+18;
      parts=Array.from({length:count},()=>({
        x:Math.random()*w, y:Math.random()*h, r:Math.random()*6.28,
        rs:(Math.random()-.5)*.01, v:.6+Math.random()*1.2, s:.8+Math.random()*.6
      }));
    }
    function draw(){
      const W=cvs.width, H=cvs.height;
      ctx.clearRect(0,0,W,H);
      for(const p of parts){
        p.y += p.v; p.r += p.rs;
        const w=spr.width*p.s, h=spr.height*p.s;
        ctx.save();
        ctx.translate(p.x*DPR, p.y*DPR);
        ctx.rotate(p.r);
        ctx.drawImage(spr, -w/2, -h/2, w, h);
        ctx.restore();
        if(p.y*DPR>H+40){ p.y=-40/DPR; p.x=Math.random()*cvs.clientWidth; p.v=.6+Math.random()*1.2; }
      }
    }
    function loop(){ if(!running) return; draw(); raf=requestAnimationFrame(loop); }

    const io=new IntersectionObserver(e=>{
      if(e[0].isIntersecting){ running=true; resize(); cancelAnimationFrame(raf); loop(); }
      else { running=false; cancelAnimationFrame(raf); }
    },{threshold:.1});
    io.observe(cvs);
    window.addEventListener('resize',()=>running&&resize());
  })();

  /* ---------- PIPE: анимация воды и точки ---------- */
  (function(){
    const flow=document.getElementById('waterFlow'); if(!flow) return;
    let x=40, sp=0.8; // скорость и позиция
    function animate(){
      x+=sp; if(x>40+400) x=40; // мягкий цикл без ускорений
      flow.setAttribute('x', x);
      requestAnimationFrame(animate);
    }
    animate();

    // точки
    const dots=[...document.querySelectorAll('.dot')];
    const steps=[...document.querySelectorAll('.step')];
    const setStep=(i)=>{
      steps.forEach(s=>s.classList.toggle('on', s.dataset.step==i));
      dots.forEach(d=>d.classList.toggle('active', d.dataset.step==i));
    };
    dots.forEach(d=>d.addEventListener('click',()=>setStep(d.dataset.step)));
  })();
  </script>
</body>
</html>
